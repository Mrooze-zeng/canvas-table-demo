(this["webpackJsonpcanvas-demo"]=this["webpackJsonpcanvas-demo"]||[]).push([[0],{1524:function(t,e,i){"use strict";i.r(e);var n=i(3),o=i.n(n),r=i(24),a=i.n(r),h=(i(31),i(32),i(25)),s=i(1),l=i(2),c=i(7),d=i(6),u=i(8),v=i.n(u),g=function(){function t(e){var i=e.name,n=void 0===i?"":i,o=e.type,r=void 0===o?"":o,a=e.text,h=void 0===a?"":a,l=e.x,c=void 0===l?0:l,d=e.y,u=void 0===d?0:d,v=e.width,g=void 0===v?100:v,y=e.height,f=void 0===y?45:y,p=e.color,x=void 0===p?"yellow":p,w=e.borderColor,m=void 0===w?"white":w,b=e.lineWidth,k=void 0===b?1:b,C=e.fixed,j=void 0===C?"":C,S=e.columns,O=void 0===S?[]:S,T=e.column,E=void 0===T?{}:T,R=e.dataSource,L=void 0===R?{}:R,M=e.stage,B=void 0===M?{}:M,P=e.layer,I=void 0===P?null:P,N=e.events,W=void 0===N?{}:N;Object(s.a)(this,t),this.name=n,this.type=r,this.text=h,this.x=c,this.y=u,this.originX=c,this.originY=u,this.width=g,this.height=f,this.ctx=B.ctx,this.color=x,this.borderColor=m,this.lineWidth=k,this.fixed=j,this.columns=O,this.column=E,this.dataSource=L,this.stage=B,this.layer=I||this,this.listeners=new Map,this.displayText=this.ellipsisText(),this.image=null,this.setEvents(W)}return Object(l.a)(t,[{key:"setEvents",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(e).forEach((function(i){t.on(i,(function(){e[i](t)}))}))}},{key:"ellipsisText",value:function(){var t=this.text,e=this.ctx.measureText(t).width,i=this.ctx.measureText("...").width,n=this.width-25;if(n<e){for(var o=t.length;e+i>n&&o>0;)t=t.substring(0,o),e=this.ctx.measureText(t).width,o-=1;return t+"..."}return t}},{key:"drawText",value:function(){this.ctx.fillStyle="#000",this.ctx.font="16px sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(this.displayText,this.x+this.width/2,this.y+this.height/2,this.width)}},{key:"drawImage",value:function(){var t=this;if(this.stage.height+this.stage.height/2>=this.y&&this.y>=0){if(this.image)return void this._drawImage(this.image);var e=new Image;e.src=this.text,e.onload=function(){t.image=e,t._drawImage(t.image)}}}},{key:"_drawImage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:35;this.ctx.drawImage(t,this.x+(this.width-e)/2,this.y+(this.height-e)/2,e,e)}},{key:"updatePosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(this.fixed){case"top":this.x=this.originX-t,this.y=this.originY;break;case"left":this.x=this.originX,this.y=this.originY-e;break;case"top,left":this.x=this.originX,this.y=this.originY;break;default:this.x=this.originX-t,this.y=this.originY-e}this.trigger("onPositionUpdate")}},{key:"isCurrentElement",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,height:0,width:0},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0},i=e.x>t.x&&e.x<t.x+t.width,n=e.y>t.y&&e.y<t.y+t.height;return i&&n}},{key:"on",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.split(",").forEach((function(e){t.listeners.set(e.trim(),i)}))}},{key:"off",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.listeners.delete(t)}},{key:"trigger",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];(this.listeners.get(t)||function(){return!1}).apply(void 0,[t,this].concat(i))}}]),t}(),y=function(t){Object(c.a)(i,t);var e=Object(d.a)(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,i),(t=e.call(this,n)).children=[],t}return Object(l.a)(i,[{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.children=this.children.concat(e).reverse(),this}},{key:"getCurrentCeil",value:function(t){var e=t.x,i=void 0===e?0:e,n=t.y,o=void 0===n?0:n,r=null;return this.children.forEach((function(t){t.isCurrentElement(t,{x:i,y:o})&&(r=t)})),r}},{key:"drawLine",value:function(){this.ctx.beginPath(),this.ctx.lineWidth=this.lineWidth,this.ctx.strokeStyle=this.borderColor,this.ctx.moveTo(this.x,this.y),this.ctx.lineTo(this.x+this.width,this.y),this.ctx.stroke()}},{key:"drawBackground",value:function(){this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x,this.y,this.width,this.height)}},{key:"draw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.updatePosition(t,e),this.drawLine(),this.children.forEach((function(i){i.draw(t,e)}))}}]),i}(g),f=i(26),p=i(10),x=i(5),w=function(t){Object(c.a)(i,t);var e=Object(d.a)(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,i),e.call(this,t)}return Object(l.a)(i,[{key:"drawBorderRight",value:function(){this.ctx.beginPath(),this.ctx.lineWidth=this.lineWidth/2,this.ctx.strokeStyle=this.borderColor,this.ctx.moveTo(this.x+this.width,this.y),this.ctx.lineTo(this.x+this.width,this.y+this.height),this.ctx.stroke()}},{key:"drawBackground",value:function(){this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x,this.y,this.width,this.height)}},{key:"draw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.updatePosition(t,e),this.drawBackground(),this.drawBorderRight(),"image"===this.column.type&&"body"===this.layer.type?Object(p.a)(Object(x.a)(i.prototype),"drawImage",this).call(this):Object(p.a)(Object(x.a)(i.prototype),"drawText",this).call(this)}}]),i}(g),m=function(){function t(e){var i=e.width,n=void 0===i?250:i,o=e.height,r=void 0===o?250:o;Object(s.a)(this,t);var a=window.devicePixelRatio||1;this.width=n*a,this.height=r*a,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=n+"px",this.canvas.style.height=r+"px",this.ctx=this.canvas.getContext("2d"),this.children=[],this.ctx.scale(a,a)}return Object(l.a)(t,[{key:"addLayer",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.children=this.children.concat(e),this}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.ctx.clearRect(0,0,this.width,this.height),this.getViewportChildren().forEach((function(i){i.draw(t,e)}))}},{key:"getViewportChildren",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,i=this.children.filter((function(t){return"body"===t.type})),n=this.children.filter((function(t){return"header"===t.type})),o=i.findIndex((function(e){return e.y>=0&&e.y<=t.height})),r=i.slice(o,Math.min(e,i.length-o)+o),a=i.slice(Math.max(0,o-e),o),h=a.concat(r);return h.concat(n)}},{key:"getCurrentLayer",value:function(t){var e=t.x,i=void 0===e?0:e,n=t.y,o=void 0===n?0:n,r=null;return this.getViewportChildren(25).forEach((function(t){t.isCurrentElement(t,{x:i,y:o})&&(r=t)})),r}},{key:"getCurrentCeil",value:function(t){var e=t.x,i=void 0===e?0:e,n=t.y,o=void 0===n?0:n,r=this.getCurrentLayer({x:i,y:o});return r?r.getCurrentCeil({x:i,y:o}):null}},{key:"triggerEventToCeil",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.getCurrentCeil(e);n&&(n.trigger(t,i),n.layer.trigger(t,i))}},{key:"setName",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0;return"function"===typeof t?t(e):String(t)}},{key:"setFixedState",value:function(t){var e=t.type,i=void 0===e?"":e,n=t.fixed,o=void 0===n?"":n,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(i){case"header":return r?"top,left":o;case"body":return r?"left":o;default:return o}}},{key:"createCeils",value:function(t){for(var e=t.layer,i=void 0===e?null:e,n=t.events,o=void 0===n?{}:n,r=t.type,a=void 0===r?"ceil":r,h=t.name,s=void 0===h?"":h,l=[],c=i.columns,d=i.dataSource,u=0;u<c.length;u++){var v=l.reduce((function(t,e,i){return t+=e.width}),0);l.push(new w({name:this.setName(s,u),type:a,text:d[c[u].key]||c[u].title,x:v,y:i.y,width:c[u].width,height:i.height,stage:this,layer:i,color:i.color,fixed:this.setFixedState(i,c[u].fixed),column:c[u],columns:c,dataSource:d,events:o}))}i.add.apply(i,l).draw()}},{key:"createRows",value:function(t){for(var e=t.dataSource,i=void 0===e?[]:e,n=t.columns,o=void 0===n?[]:n,r=t.layerOptions,a=void 0===r?{}:r,h=t.ceilOptions,s=void 0===h?{}:h,l=[],c=a.name,d=void 0===c?"":c,u=a.type,v=void 0===u?"body":u,g=a.width,p=void 0===g?100:g,x=a.height,w=void 0===x?45:x,m=a.color,b=void 0===m?"white":m,k=a.x,C=void 0===k?0:k,j=a.y,S=void 0===j?0:j,O=a.events,T=void 0===O?{}:O,E=0;E<i.length;E++){var R=new y({name:this.setName(d,E),type:v,x:C,y:S+E*w,stage:this,width:p,height:w,color:b,columns:o,dataSource:i[E],events:T});this.createCeils(Object(f.a)({layer:R},s)),l.push(R)}return l}},{key:"insertCanvas",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:HTMLElement;t.querySelector("canvas")||t.appendChild(this.canvas)}}]),t}(),b=i(0),k=function(t){Object(c.a)(i,t);var e=Object(d.a)(i);function i(t){var o;return Object(s.a)(this,i),(o=e.call(this,t)).handleScroll=v.a.throttle((function(t){var e=t.target,i=e.scrollTop,n=e.scrollLeft,r=o.props,a=r.onScrollToTop,h=void 0===a?function(){}:a,s=r.onScrollToBottom,l=void 0===s?function(){}:s;o.stage.render(n,i),0===i&&h(),o.scrollEndRef.getBoundingClientRect().bottom-t.target.getBoundingClientRect().bottom===0&&l()}),0),o.handleMouseMove=v.a.debounce((function(t){var e=t.target.getBoundingClientRect(),i=e.left,n=e.top,r=t.clientX-i,a=t.clientY-n,h=o.stage.getCurrentCeil({x:r,y:a});if(h)if("body"===h.layer.type)"image"===h.column.type?o.wrapperRef.style.cursor="pointer":o.wrapperRef.style.cursor="text";else o.wrapperRef.style.cursor="auto"}),10),o.handleMouseEnter=v.a.debounce((function(t){}),100),o.handleMouseOut=v.a.debounce((function(t){o.wrapperRef.style.cursor="auto"}),100),o.wrapperRef=Object(n.createRef)(),o.inputLayerRef=Object(n.createRef)(),o.scrollEndRef=Object(n.createRef)(),o.columns=t.columns,o.dataSource=t.dataSource,o.width=650,o.height=450,o.stage=new m({width:o.width,height:o.height}),o.state={inputLayerStyle:{},inputLayerVisibleState:!1,currentText:"",scrollEndPosition:{top:0,left:0}},o}return Object(l.a)(i,[{key:"componentDidMount",value:function(){var t,e=new y({type:"header",x:0,y:0,stage:this.stage,width:this._getTotalWidth(),height:45,color:"orange",fixed:"top",columns:this.columns});this.stage.insertCanvas(this.wrapperRef),this.stage.createCeils({layer:e});var i=this.stage.createRows({dataSource:this.dataSource,columns:this.columns,layerOptions:{width:this._getTotalWidth(),y:45,color:"green"},ceilOptions:{events:{onClick:this.handleCeilClick.bind(this),onPositionUpdate:this.handleCeilScroll.bind(this)}}});(t=this.stage).addLayer.apply(t,[e].concat(Object(h.a)(i))),this.setState({scrollEndPosition:{top:45*this.stage.children.length,left:this._getTotalWidth()-this.width/2+5}})}},{key:"_getTotalWidth",value:function(){var t=0;return this.columns.forEach((function(e){t+=e.width})),t}},{key:"handleCeilClick",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.dataSource,i=void 0===e?{}:e,n=t.image,o=t.column,r=void 0===o?{}:o;"image"===r.type?(document.body.querySelectorAll("img").forEach((function(t){t.remove()})),document.body.appendChild(n),alert("click on ".concat(i.name,"'s avatar"))):this.updateInputLayer(t),console.log("click on ceil: ",t)}},{key:"handleCeilScroll",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.state.inputLayerVisibleState;e&&this.updateInputLayer(t,!1)}},{key:"updateInputLayer",value:function(t){var e=this,i=t.width,n=void 0===i?0:i,o=t.height,r=void 0===o?0:o,a=t.x,h=void 0===a?0:a,s=t.y,l=void 0===s?0:s,c=t.text,d=void 0===c?"":c,u=t.color,v=void 0===u?"orange":u,g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.setState({inputLayerStyle:{display:g?"inline-block":"none",width:n,height:r,top:l,left:h,zIndex:1,background:v},currentText:d,inputLayerVisibleState:g}),g&&setTimeout((function(){e.inputLayerRef.focus()}))}},{key:"handleClick",value:function(t){var e=t.target.getBoundingClientRect(),i=e.left,n=e.top,o=t.clientX-i,r=t.clientY-n;this.stage.triggerEventToCeil("onClick",{x:o,y:r},{x:o,y:r})}},{key:"handleDoubleClick",value:function(){console.log("handleDoubleClick")}},{key:"handleContextMenu",value:function(t){console.log("handleContextMenu"),t.preventDefault(),t.stopPropagation()}},{key:"handleBlur",value:function(){this.updateInputLayer({},!1)}},{key:"render",value:function(){var t=this,e=this.state,i=e.inputLayerStyle,n=e.currentText,o=e.scrollEndPosition;return Object(b.jsx)("div",{className:"wrapper",ref:function(e){return t.wrapperRef=e},onClick:this.handleClick.bind(this),onBlur:this.handleBlur.bind(this),onDoubleClick:this.handleDoubleClick.bind(this),onContextMenu:this.handleContextMenu.bind(this),onMouseMove:this.handleMouseMove.bind(this),onMouseEnter:this.handleMouseEnter.bind(this),onMouseOut:this.handleMouseOut.bind(this),children:Object(b.jsx)("div",{className:"wrapper-scroll",children:Object(b.jsxs)("div",{className:"wrapper-scroll-inner",style:{width:this.width+10,height:this.height+10},onScroll:this.handleScroll.bind(this),children:[Object(b.jsx)("div",{className:"wrapper-scroll-end",ref:function(e){return t.scrollEndRef=e},style:o}),Object(b.jsx)("div",{className:"input-placeholder",ref:function(e){return t.inputLayerRef=e},style:i,onClick:function(t){t.preventDefault(),t.stopPropagation()},contentEditable:!0,suppressContentEditableWarning:!0,children:n})]})})})}}],[{key:"getDerivedStateFromProps",value:function(t,e){return null}}]),i}(n.Component),C=i(4),j=i.n(C),S=[{title:"No.",width:100,key:"id",fixed:!0},{title:"Avatar",width:100,type:"image",key:"avatar",fixed:!0},{title:"Name",width:120,key:"name",fixed:!0},{title:"Age",width:100,key:"age"},{title:"Province",width:100,key:"province"},{title:"City",width:120,key:"city"},{title:"Address",width:200,key:"address"},{title:"ZipCode",width:100,key:"zipcode"},{title:"Description",width:250,key:"description"},{title:"Action",width:100,key:"action"}],O=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=0;i<e;i++)t.push({id:""+i,avatar:j.a.image.avatar(),province:j.a.address.state(),city:j.a.address.city(),name:j.a.name.findName(),zipcode:j.a.address.zipCode(),age:j.a.datatype.number(100),description:j.a.lorem.sentence(),address:j.a.address.streetAddress()});return t}([]);var T=function(){return Object(b.jsx)(k,{columns:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=t.filter((function(t){return t.fixed}));return e.concat(t.filter((function(t){return!t.fixed})))}(S),dataSource:O,onScrollToTop:function(){console.log("to the top")},onScrollToBottom:function(){console.log("to the bottom")}})},E=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,1525)).then((function(e){var i=e.getCLS,n=e.getFID,o=e.getFCP,r=e.getLCP,a=e.getTTFB;i(t),n(t),o(t),r(t),a(t)}))};a.a.render(Object(b.jsx)(o.a.StrictMode,{children:Object(b.jsx)(T,{})}),document.getElementById("root")),E()},31:function(t,e,i){},32:function(t,e,i){}},[[1524,1,2]]]);
//# sourceMappingURL=main.b4bbb132.chunk.js.map
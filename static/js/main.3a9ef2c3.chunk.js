(this["webpackJsonpcanvas-demo"]=this["webpackJsonpcanvas-demo"]||[]).push([[0],{1522:function(t,e,i){"use strict";i.r(e);var n=i(3),o=i.n(n),a=i(24),r=i.n(a),h=(i(29),i(30),i(1)),s=i(2),l=i(7),c=i(6),d=i(8),u=i.n(d),v=i(10),g=i(5),f=function(){function t(e){var i=e.name,n=void 0===i?"":i,o=e.text,a=void 0===o?"":o,r=e.x,s=void 0===r?0:r,l=e.y,c=void 0===l?0:l,d=e.width,u=void 0===d?100:d,v=e.height,g=void 0===v?45:v,f=e.color,y=void 0===f?"yellow":f,p=e.fixed,m=void 0===p?"":p,x=e.columns,w=void 0===x?[]:x,b=e.column,k=void 0===b?{}:b,C=e.dataSource,S=void 0===C?{}:C,j=e.stage,O=void 0===j?{}:j,T=e.layer,E=void 0===T?null:T,R=e.onFocus,M=void 0===R?function(){}:R,L=e.onScroll,B=void 0===L?function(){}:L;Object(h.a)(this,t),this.name=n,this.text=a,this.x=s,this.y=c,this.originX=s,this.originY=c,this.width=u,this.height=g,this.ctx=O.ctx,this.color=y,this.fixed=m,this.columns=w,this.column=k,this.dataSource=S,this.onFocus=M,this.onScroll=B,this.stage=O,this.layer=E||this,this.listeners=new Map,this.displayText=this.ellipsisText(),this.image=null}return Object(s.a)(t,[{key:"ellipsisText",value:function(){var t=this.text,e=this.ctx.measureText(t).width,i=this.ctx.measureText("...").width,n=this.width-25;if(n<e){for(var o=t.length;e+i>n&&o>0;)t=t.substring(0,o),e=this.ctx.measureText(t).width,o-=1;return t+"..."}return t}},{key:"drawText",value:function(){this.ctx.fillStyle="#000",this.ctx.font="16px sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(this.displayText,this.x+this.width/2,this.y+this.height/2,this.width)}},{key:"drawImage",value:function(){var t=this;if(this.stage.height+this.stage.height/2>=this.y&&this.y>=0){if(this.image)return void this._drawImage(this.image);var e=new Image;e.src=this.text,e.onload=function(){t.image=e,t._drawImage(t.image)}}}},{key:"_drawImage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:35;this.ctx.drawImage(t,this.x+(this.width-e)/2,this.y+(this.height-e)/2,e,e)}},{key:"commonTrigger",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=null;this.children.forEach((function(t){t.isCurrentElement(t,e)&&(i=t)})),i&&i.trigger(t,e)}},{key:"update",value:function(t){var e=t.x,i=void 0===e?this.x:e,n=t.y,o=void 0===n?this.y:n,a=t.width,r=void 0===a?this.width:a,h=t.height,s=void 0===h?this.height:h,l=t.color,c=void 0===l?this.color:l;this.x=i,this.y=o,this.width=r,this.height=s,this.color=c,this.parent&&this.parent.draw()}},{key:"updatePosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(this.fixed){case"top":this.x=this.originX-t,this.y=this.originY;break;case"left":this.x=this.originX,this.y=this.originY-e;break;case"top,left":this.x=this.originX,this.y=this.originY;break;default:this.x=this.originX-t,this.y=this.originY-e}this.onScroll(this)}},{key:"setParent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.parent=t}},{key:"isCurrentElement",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0,height:0,width:0},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0},i=e.x>t.x&&e.x<t.x+t.width,n=e.y>t.y&&e.y<t.y+t.height;return i&&n}},{key:"on",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.split(",").forEach((function(e){t.listeners.set(e.trim(),i)}))}},{key:"off",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.listeners.delete(t)}},{key:"trigger",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];(this.listeners.get(t)||function(){return!1}).apply(void 0,[t].concat(i))}}]),t}(),y=function(t){Object(l.a)(i,t);var e=Object(c.a)(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(h.a)(this,i),e.call(this,t)}return Object(s.a)(i,[{key:"setEvent",value:function(){var t=this;this.on("click",(function(){console.log("click on ceil",t),t.onFocus(t)})),this.on("move",(function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0};console.log("move...",e),t.update(e)}))}},{key:"drawBorder",value:function(){this.ctx.strokeStyle="white",this.ctx.lineWidth=.5,this.ctx.strokeRect(this.x,this.y,this.width,this.height)}},{key:"drawBackground",value:function(){this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x,this.y,this.width,this.height)}},{key:"draw",value:function(){this.drawBackground(),this.drawBorder(),"image"===this.column.type&&"body"===this.parent.name?Object(v.a)(Object(g.a)(i.prototype),"drawImage",this).call(this):Object(v.a)(Object(g.a)(i.prototype),"drawText",this).call(this),this.setEvent()}}]),i}(f),p=function(t){Object(l.a)(i,t);var e=Object(c.a)(i);function i(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(h.a)(this,i),(t=e.call(this,n)).children=[],t}return Object(s.a)(i,[{key:"add",value:function(){for(var t=this,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return this.children=this.children.concat(i).reverse(),this.children.forEach((function(e){e.setParent(t)})),this.draw(),this}},{key:"setEvent",value:function(){this.on("click,move",this.commonTrigger.bind(this))}},{key:"draw",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x,this.y,this.width,this.height),this.children.forEach((function(i){i.updatePosition(t,e),i.draw(t,e)})),this.setEvent()}}]),i}(f),m=function(){function t(e){var i=e.width,n=void 0===i?250:i,o=e.height,a=void 0===o?250:o;Object(h.a)(this,t);var r=window.devicePixelRatio||1;this.width=n*r,this.height=a*r,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=n+"px",this.canvas.style.height=a+"px",this.ctx=this.canvas.getContext("2d"),this.children=[],this.ctx.scale(r,r)}return Object(s.a)(t,[{key:"addLayer",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return this.children=this.children.concat(e).reverse(),this.render(),this}},{key:"render",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.getViewportChildren().forEach((function(n){!n.parent&&n.setParent(t),n.updatePosition(e,i),n.draw(e,i)}))}},{key:"getViewportChildren",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,i=this.children.filter((function(t){return"body"===t.name})),n=this.children.filter((function(t){return"header"===t.name})),o=i.findIndex((function(e){return e.y>=0&&e.y<=t.height})),a=i.slice(o,Math.min(e,i.length-o)+o),r=i.slice(Math.max(0,o-e),o),h=r.concat(a);return h.concat(n)}},{key:"getCurrentCeil",value:function(t){var e=t.x,i=void 0===e?0:e,n=t.y,o=void 0===n?0:n,a=null,r=null;return this.getViewportChildren(25).forEach((function(t){t.isCurrentElement(t,{x:i,y:o})&&(a=t)})),a&&a.children.forEach((function(t){t.isCurrentElement(t,{x:i,y:o})&&(r=t)})),r}},{key:"insertCanvas",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:HTMLElement;t.querySelector("canvas")||t.appendChild(this.canvas)}}]),t}(),x=i(0),w=function(t){Object(l.a)(i,t);var e=Object(c.a)(i);function i(t){var o;return Object(h.a)(this,i),(o=e.call(this,t)).handleScroll=u.a.throttle((function(t){var e=t.target,i=e.scrollTop,n=e.scrollLeft,a=o.props,r=a.onScrollToTop,h=void 0===r?function(){}:r,s=a.onScrollToBottom,l=void 0===s?function(){}:s;o.stage.render(n,i),0===i&&h(),o.scrollEndRef.getBoundingClientRect().bottom-t.target.getBoundingClientRect().bottom===0&&l()}),10),o.handleMouseMove=u.a.debounce((function(t){var e=t.target.getBoundingClientRect(),i=e.left,n=e.top,a=t.clientX-i,r=t.clientY-n,h=o.stage.getCurrentCeil({x:a,y:r});h&&("body"===h.layer.name&&"image"!==h.column.type?o.wrapperRef.style.cursor="text":"body"===h.layer.name&&"image"===h.column.type?o.wrapperRef.style.cursor="pointer":o.wrapperRef.style.cursor="auto")}),50),o.handleMouseEnter=u.a.debounce((function(t){}),100),o.handleMouseOut=u.a.debounce((function(t){o.wrapperRef.style.cursor="auto"}),100),o.wrapperRef=Object(n.createRef)(),o.inputLayerRef=Object(n.createRef)(),o.scrollEndRef=Object(n.createRef)(),o.columns=t.columns,o.dataSource=t.dataSource,o.width=650,o.height=450,o.stage=new m({width:o.width,height:o.height}),o.state={inputLayerStyle:{},inputLayerVisibleState:!1,currentText:""},o}return Object(s.a)(i,[{key:"componentDidMount",value:function(){var t,e=new p({name:"header",x:0,y:0,stage:this.stage,width:this._getTotalWidth(),height:45,color:"white",fixed:"top",columns:this.columns,dataSource:{}}),i=[];this.stage.insertCanvas(this.wrapperRef),this._createCeil({layer:e,color:"orange"});for(var n=0;n<this.dataSource.length;n++){var o=new p({name:"body",x:0,y:45+46*n,stage:this.stage,width:this._getTotalWidth(),height:45,color:"white",columns:this.columns,dataSource:this.dataSource[n]});this._createCeil({y:o.y,layer:o,row:n}),i.push(o)}(t=this.stage).addLayer.apply(t,[e].concat(i))}},{key:"_getTotalWidth",value:function(){var t=0;return this.columns.forEach((function(e){t+=e.width})),t}},{key:"_getTotalHeight",value:function(){return 45*this.dataSource.length}},{key:"_createCeil",value:function(t){for(var e=this,i=t.y,n=void 0===i?0:i,o=t.layer,a=void 0===o?null:o,r=t.color,h=void 0===r?"green":r,s=t.row,l=void 0===s?0:s,c=this,d=[],u="",v=a.columns,g=a.dataSource,f=function(t){var i=d.reduce((function(t,e,i){return t+=e.width}),0);u="body"===a.name&&v[t].fixed?"left":"header"===a.name&&v[t].fixed?"top,left":a.fixed,d.push(new y({name:"\u5217".concat(t,"-\u884c").concat(l),text:g[v[t].key]||v[t].title,x:i,y:n,width:v[t].width,height:45,stage:e.stage,layer:a,color:h,fixed:u,column:v[t],columns:v,dataSource:g,onFocus:function(e){var i=e.dataSource,n=void 0===i?{}:i,o=e.image;"body"===a.name&&"image"===v[t].type?(document.body.querySelectorAll("img").forEach((function(t){t.remove()})),document.body.appendChild(o),alert("click on ".concat(n.name,"'s avatar"))):"body"===a.name&&"image"!==v[t].type&&c.updateInputLayer.call(c,this)},onScroll:function(){c.state.inputLayerVisibleState&&c.updateInputLayer.call(c,this,!1)}}))},p=0;p<v.length;p++)f(p);a.add.apply(a,d)}},{key:"updateInputLayer",value:function(t){var e=this,i=t.width,n=void 0===i?0:i,o=t.height,a=void 0===o?0:o,r=t.x,h=void 0===r?0:r,s=t.y,l=void 0===s?0:s,c=t.text,d=void 0===c?"":c,u=t.color,v=void 0===u?"orange":u,g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.setState({inputLayerStyle:{display:g?"inline-block":"none",width:n,height:a,top:l,left:h,zIndex:1,background:v},currentText:d,inputLayerVisibleState:g}),g&&setTimeout((function(){e.inputLayerRef.focus()}))}},{key:"commonTrigger",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=e.target.getBoundingClientRect(),o=n.left,a=n.top,r=e.clientX-o,h=e.clientY-a,s=null;this.stage.getViewportChildren(20).forEach((function(t){t.isCurrentElement(t,{x:r,y:h})&&(s=t)})),s&&(s.trigger(t,{x:r,y:h}),i())}},{key:"handleClick",value:function(t){this.commonTrigger("click",t)}},{key:"handleDoubleClick",value:function(){console.log("handleDoubleClick")}},{key:"handleContextMenu",value:function(t){console.log("handleContextMenu"),t.preventDefault(),t.stopPropagation()}},{key:"handleBlur",value:function(){this.updateInputLayer({},!1)}},{key:"calculateScrollEndPosition",value:function(){return{top:this._getTotalHeight()+40+this.dataSource.length,left:this._getTotalWidth()-this.width/2+5}}},{key:"render",value:function(){var t=this,e=this.state,i=e.inputLayerStyle,n=e.currentText;return Object(x.jsx)("div",{className:"wrapper",ref:function(e){return t.wrapperRef=e},onClick:this.handleClick.bind(this),onBlur:this.handleBlur.bind(this),onDoubleClick:this.handleDoubleClick.bind(this),onContextMenu:this.handleContextMenu.bind(this),onMouseMove:this.handleMouseMove.bind(this),onMouseEnter:this.handleMouseEnter.bind(this),onMouseOut:this.handleMouseOut.bind(this),children:Object(x.jsx)("div",{className:"wrapper-scroll",children:Object(x.jsxs)("div",{className:"wrapper-scroll-inner",style:{width:this.width+10,height:this.height+10},onScroll:this.handleScroll.bind(this),children:[Object(x.jsx)("div",{className:"wrapper-scroll-end",ref:function(e){return t.scrollEndRef=e},style:this.calculateScrollEndPosition()}),Object(x.jsx)("div",{className:"input-placeholder",ref:function(e){return t.inputLayerRef=e},style:i,onClick:function(t){t.preventDefault(),t.stopPropagation()},contentEditable:!0,suppressContentEditableWarning:!0,children:n})]})})})}}],[{key:"getDerivedStateFromProps",value:function(t,e){return null}}]),i}(n.Component),b=i(4),k=i.n(b),C=[{title:"No.",width:100,key:"id",fixed:!0},{title:"Avatar",width:100,type:"image",key:"avatar",fixed:!0},{title:"Name",width:120,key:"name",fixed:!0},{title:"Age",width:100,key:"age"},{title:"Province",width:100,key:"province"},{title:"City",width:120,key:"city"},{title:"Address",width:200,key:"address"},{title:"ZipCode",width:100,key:"zipcode"},{title:"Description",width:250,key:"description"},{title:"Action",width:100,key:"action"}],S=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,i=0;i<e;i++)t.push({id:""+i,avatar:k.a.image.avatar(),province:k.a.address.state(),city:k.a.address.city(),name:k.a.name.findName(),zipcode:k.a.address.zipCode(),age:k.a.datatype.number(100),description:k.a.lorem.sentence(),address:k.a.address.streetAddress()});return t}([]);var j=function(){return Object(x.jsx)(w,{columns:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=t.filter((function(t){return t.fixed}));return e.concat(t.filter((function(t){return!t.fixed})))}(C),dataSource:S,onScrollToTop:function(){console.log("to the top")},onScrollToBottom:function(){console.log("to the bottom")}})},O=function(t){t&&t instanceof Function&&i.e(3).then(i.bind(null,1523)).then((function(e){var i=e.getCLS,n=e.getFID,o=e.getFCP,a=e.getLCP,r=e.getTTFB;i(t),n(t),o(t),a(t),r(t)}))};r.a.render(Object(x.jsx)(o.a.StrictMode,{children:Object(x.jsx)(j,{})}),document.getElementById("root")),O()},29:function(t,e,i){},30:function(t,e,i){}},[[1522,1,2]]]);
//# sourceMappingURL=main.3a9ef2c3.chunk.js.map